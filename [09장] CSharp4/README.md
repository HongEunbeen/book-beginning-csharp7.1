# 9장 C# 4.0

- C#4.0은 닷넷 프레임워크 4.0에서 실행
- 닷넷 4.0은 CLR 버전이 올라감 → 새롭게 CLR 4.0에서 운영
    - GAC가 분리됨 → 같은 동작을 하는 어셈블리를 .NET 2.0/ .NET 4.0 환경으로 각각 빌드 해 제공해야 함(GAC에 등록된 경우 아니라면 필요 X)

## 선택적 매개변수와 명명된 인자

- 선택적 매개변수 : 메서드의 매개변수 가운데 전달되지 않은 인자가 있는 경우 미리 지정된 기본값을 사용하는 것
- 동일한 기능을 매개변수만 달리해 구현 → 오버로드 사용
    - 선택적 매개변수 이용시 단 하나의 메서드만 정의하는 것으로 오버로드 기능 만족
- 매개변수에 기본값 지정 = 선택적 매개변수
    
    ```csharp
    public void Output(string name, int age = 0, string address = "Korea")
    {
    	..
    }
    ```
    
    → 필수 매개변수 : `name`
    
    → 선택적 매개변수 : `age`, `address`
    
- 선택적 매개변수 규칙
    - `ref`, `out`예약어와 함께 사용 불가
    - 선택적 매개변수 사이에 필수 매개변수 사용 불가
    - 선택적 매개변수 마지막에 `params`유형의 매개변수 정의 가능
    - `params`매개변수 선택적 매개변수 불가 → 기본값을 지정 X
    - 기본값은 반드시 상수 표현식
    - 선택적 매개변수에 전달되는 인자는 차례대로 대응 → 중간에 생략되어 전달 불가
        - 명명된 인자를 사용해 해결 가능
- 명명된 인자 : 호출자에서 매개변수를 지정해 값을 전달 가능
    - `p.Output("Tom", address : "Tibet");`
    - 명명된 인자를 선택적 매개변수에만 적용 X, 순서 지켜야 할 필요 X
    - 모든 유요한 메서드 호출에서 사용 가능

## dynamic 예약어

- MS에서는 동적언어와 닷넷 프레임워크가 호환되도록 CLR을 바탕으로한 DLR 라이브러리 출시
    - 문제 : 동적 언어로 만들어진 프로그램의 타입 시스템을 C# 정적 언어에서 연동하는 방법 X
- `dynamic` : C# 4.0에 동적 언어와의 연동을 쉽게 할수 있음
    - DLR 위에서 동작하는 언어와의 상호운영성 높이는것이 주된 목표
    - 다른 문제까지 자연스럽게 해결
- dynamic 변수 : 컴파일 시점에 타입을 결정하지 않고, 해당 프로그램이 실행되는 시점에 타입 결정
    - 컴파일 시에는 오류가 발생하지 않을 수 있어도 실행시에는 오류 발생
    - C#는 컴파일 시점에 dynamic를 obejct 타입으로 바꿈
    - dynamic예약어도 간편 표기의 한 부류,,,
    - var : C# 컴파일러가 빌드 시점에 초깃값과 대응되는 타입으로 치환

### 리플렉션 개션

- 리플렉션 기술은 소스코드를 복잡하게 만드는데 `dynamic`예약어를 사용하면 확장 모듈을 사용하기 쉽게 만들어줌
    - 리플렉션 기술이 `dynamic`의 근간을 이루고 있음! → `dynamic`리플렉션의 간편 표기법 정도
- 확장 모듈로부터 생성된 객체를 `dynamic`변수에 담아 사전에 정의된 메서드의 이름으로 호출
    - 기존에는 직접 로드한 어셈블리 안 타입의 메서드 호출하려면 리플렉션 이용해야 함

### 덕 타이핑

- 덕 타이핑 : 동적언어에서 널리 사용되며 강력한 형식을 기반으로 하지 않고 단지 같은 이르므이 속성이나 메서드가 공통으로 제공되면 기능적인 관점에서 동일한 객체라고 봄
    - 객체지향 언어는 강력한 형식으로 특정 속성이나 메서드를 호출하고 싶다면 반드시 형식을 기반으로 동작
- `dynamic`예약어는 동적 언어에서나 가능하던 덕 타이핑을 정적 언어인 C#에서 가능하게 만듬
    
    ```csharp
    int DuckTypingCall(dynamic target, dynamic item)
    {
    	return target.IndexOf(item);
    }
    string txt = "test text";
    List<int> list = new List<int> {1,2,3,4,5};
    
    DuckTypingCall(text, "test");
    DuckTypingCall(list, 3);
    ```
    
    → `string.IndexOf()`와 `List.IndexOf()`는 공통 타입이 아니지만 `dynamic`의 덕 타이핑으로 같은 메서드 사용 가능
    

### 동적 언어와의 타입 연동

- C# 프로젝트에 DLR 및 동적 언어을 사용할 수 있는 관련 어셈블리참조 추가하면 동적 코드를 C#에서 실행 가능
    - 소스코드를 실행하는 단순한 수준의 연동
- `dynamic`예약어 사용하면 더 높은 수준의 연동 가능
    - 동적 언어 소스코드에 정의된 함수 C#에서 호출 → 인자, 반환값 OK
    - C# 함수 동적 언어 소스코드에서 호출
